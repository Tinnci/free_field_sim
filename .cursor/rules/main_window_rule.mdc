---
description: 
globs: *.py
alwaysApply: false
---
\
---
title: "Main GUI Window"
files: ["[src/gui/main_window.py](mdc:src/gui/main_window.py)"]
---

`main_window.py` 文件定义了声学仿真工具的主用户界面 (GUI)。它使用 PySide6 构建，并集成了 Matplotlib 和 PyVista 用于绘图。

主要功能包括：
- 设置仿真参数（房间尺寸、RT60、信号时长）。
- 管理声源和麦克风（添加、编辑、移除，支持详细参数化，结构化对象管理）。
- 运行声学仿真。
- 以选项卡形式显示结果（3D场景、RIR、时域、频域、评估结果）。
- ground truth 选择下拉框，支持"全部叠加"与单声源参考。
- 保存和加载仿真配置（支持详细参数结构，默认目录为 configs/ ，已支持版本号字段）。
- 支持对象点击拾取与属性显示，3D属性面板已采用专用按钮进行编辑。
- 新增3D视角重置按钮，提升交互体验。
- 初始化顺序与数据结构已优化，避免常见错误。
- 菜单栏集成"帮助"菜单，弹出简要使用说明。

## 关键实现与建议

- **默认对象校验**：加载配置后若无声源/麦克风，自动补充默认对象。默认对象定义已常量化，避免多处 hardcode。
- **3D拾取健壮性**：PyVista actor高亮失败时有日志输出。空间拾取模式下实现最近对象距离判断与阈值判定。
- **仿真失败时plot清空**：仿真异常时清空所有plot并在图上显示错误信息。
- **配置版本兼容性**：加载配置时根据 `config_version` 做兼容处理，便于未来结构升级。
- **ground truth选择**：支持全部叠加或单声源，所有评估和绘图均以此为准。
- **输入校验**：添加/编辑对象时校验其位置是否在房间内，参数是否合理，必要时弹窗警告。
- **评估指标扩展**：评估标签页展示MSE、C50、D50、SNR等多种指标。
- **滤波器阶数参数化**：麦克风属性对话框支持设置滤波器阶数，仿真时自动应用。
- **文档与示例**：建议在 `configs/` 目录下提供多种典型场景配置，并在GUI中集成帮助菜单。

## GUI 交互与用户体验优化建议

- 属性面板的"编辑"操作已采用专用按钮，提升用户体验和可维护性。
- 3D对象拾取距离阈值（如0.15m/0.12m）可考虑与对象尺寸或场景自适应，或在设置中暴露为可调参数。
- 若用户移除所有声源/麦克风，当前会自动补充默认对象。可考虑在设置中增加"允许无对象"选项，提升灵活性。











